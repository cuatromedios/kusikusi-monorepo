(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[3],{"0364":function(e,t,n){},"0733":function(e,t,n){"use strict";var i=n("0364"),a=n.n(i);a.a},"4b82":function(e,t,n){},"4c65":function(e,t,n){"use strict";var i=n("4b82"),a=n.n(i);a.a},"82dc":function(e,t,n){"use strict";var i=n("b69d"),a=n.n(i);a.a},8928:function(e,t,n){"use strict";var i=n("d01d"),a=n.n(i);a.a},b69d:function(e,t,n){},cf8e:function(e,t,n){"use strict";n.r(t);var i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nq-page",{attrs:{title:e.getEntityTitle,"max-width":"lg"}},[e.ancestors.length>0?n("template",{slot:"before"},[n("q-breadcrumbs",[e._l(e.ancestors,(function(e){return n("q-breadcrumbs-el",{key:e.id,attrs:{label:e.title,to:{name:"content",params:{entity_id:e.id}}}})})),n("q-breadcrumbs-el")],2)],1):e._e(),e.$store.state.ui.config&&e.$store.state.ui.config.langs.length>1?n("div",{staticClass:"rounded-borders shadow-1",attrs:{id:"langSelector"}},[e._l(e.$store.state.ui.config.langs,(function(t){return n("q-radio",{key:t,attrs:{size:"sm",val:t,label:e.$t(t)},model:{value:e.contentLang,callback:function(t){e.contentLang=t},expression:"contentLang"}})})),n("q-radio",{attrs:{val:"all",label:e.$t("all")},model:{value:e.contentLang,callback:function(t){e.contentLang=t},expression:"contentLang"}})],2):e._e(),n("template",{slot:"aside"},[n("h2",[e._v(e._s(e.$t("contents.publication")))]),n("q-card",[e.loading?e._e():n("q-card-section",[n("div",{staticClass:"row q-col-gutter-sm"},[n("nq-field",{staticClass:"col-12",attrs:{dense:"",readonly:!e.editing}},[n("q-checkbox",{attrs:{label:e.$t("contents.active"),disable:!e.editing,"left-label":"",color:"dark"},model:{value:e.entity.is_active,callback:function(t){e.$set(e.entity,"is_active",t)},expression:"entity.is_active"}})],1),n("nq-select",{staticClass:"col-12",attrs:{dense:"",label:e.$t("contents.view"),readonly:!e.editing,options:e.views},model:{value:e.entity.view,callback:function(t){e.$set(e.entity,"view",t)},expression:"entity.view"}}),e.editing?n("nq-date-time",{staticClass:"col-12",attrs:{dense:"","display-format":"dddd DD MMMM YYYY, h:mm a",label:e.$t("contents.publishedAt"),readonly:!e.editing},model:{value:e.entity.published_at,callback:function(t){e.$set(e.entity,"published_at",t)},expression:"entity.published_at"}}):e._e(),e.editing?e._e():n("nq-field",{staticClass:"col-12",attrs:{label:e.$t("contents.publishedAt"),readonly:"","stack-label":""}},[n("p",[e._v(e._s(e._f("moment")(e.entity.published_at,"dddd DD MMMM YYYY, h:mm a"))+"\n              "),n("small",[e._v("(UTC "+e._s(e._f("moment")(e.entity.published_at,"Z"))+")")])])]),n("nq-field",{staticClass:"col-12",attrs:{label:"ID",readonly:"","stack-label":""}},[n("p",[e._v(e._s(e.entity.id))])])],1)]),e.loading?n("q-card-section",[n("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QSlider"}}),n("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QSlider"}}),n("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QSlider"}}),n("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QSlider"}})],1):e._e()],1)],1),e._l(e.fieldsets,(function(t,i){return n("div",{key:i},[n("h2",[e._v(e._s(e.$t(t.label)))]),n("q-card",[n("q-card-section",[n("div",{staticClass:"row q-col-gutter-md"},e._l(t.components,(function(t,i){return n(t.component,e._b({directives:[{name:"show",rawName:"v-show",value:!t.isMultiLang||t.isMultiLang&&(t.props.lang===e.contentLang||"all"===e.contentLang),expression:"!component.isMultiLang || (component.isMultiLang && (component.props.lang === contentLang || contentLang === 'all'))"}],key:i,tag:"div",staticClass:"col-12",attrs:{label:e.$t(t.label)+" "+(t.isMultiLang?"("+t.props.lang+")":""),readonly:!e.editing,"data-multilingual":t.isMultiLang,"data-lang":t.props?t.props.lang:"",lang:t.props?t.props.lang:null,entity:e.entity,value:e.getValue(t)},on:{input:function(n){return e.setValue(t,n)}}},"div",t.props,!1))})),1)])],1)],1)})),n("div",{staticClass:"fixed-top-right text-white action-buttons"},[e.editing||e.loading?e._e():n("q-btn",{staticClass:"bg-accent no-border-radius",attrs:{push:"",size:"lg",icon:"edit",label:e.$t("general.edit"),disable:e.saving},on:{click:function(t){e.editing=!0}}}),e.editing?n("q-btn",{staticClass:"no-border-radius q-mr-sm",attrs:{flat:"",size:"md",label:e.$t("general.cancel")},on:{click:e.cancel}}):e._e(),e.editing?n("q-btn",{staticClass:"bg-positive no-border-radius",attrs:{push:"",size:"lg",icon:"cloud_upload",disable:e.loading||e.saving,loading:e.saving,label:e.$t("general.save")},on:{click:e.save}}):e._e()],1)],2)},a=[],o=(n("a481"),n("7514"),n("967e")),r=n.n(o),s=(n("96cf"),n("fa84")),l=n.n(s),d=n("2ef0"),c=n.n(d),u=n("c1df"),m=n.n(u),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.readonly,expression:"readonly"}]},[e.loading?n("div",{staticClass:"flex column items-end"},[n("q-skeleton",{staticClass:"q-mb-md",attrs:{type:"QBtn"}}),n("q-skeleton",{staticClass:"q-mb-md full-width",attrs:{type:"QInput"}}),n("q-skeleton",{staticClass:"q-mb-md full-width",attrs:{type:"QInput"}}),n("q-skeleton",{staticClass:"q-mb-md full-width",attrs:{type:"QInput"}})],1):e._e(),e.loading?e._e():n("div",[n("div",{staticClass:"q-mb-md flex justify-end"},[e.models&&e.models.length>1?n("q-btn-dropdown",{attrs:{outline:"",color:"positive",icon:"add_circle",label:e.$t("general.add")}},[n("q-list",e._l(e.models,(function(t){return n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t,attrs:{clickable:""},on:{click:function(n){return e.add(t)}}},[n("q-item-section",[n("q-item-label",[e._v(e._s(e.$t(e.$store.getters.nameOf(t))))])],1)],1)})),1)],1):e._e(),e.models&&1===e.models.length?n("q-btn",{attrs:{outline:"",color:"positive",icon:"add_circle",label:e.$t("general.add")+" "+e.$t(e.$store.getters.nameOf(e.models[0]))},on:{click:function(t){return e.add(e.models[0])}}}):e._e()],1),n("q-list",{attrs:{bordered:""}},[n("draggable",e._b({attrs:{disabled:!e.reorderMode},model:{value:e.children,callback:function(t){e.children=t},expression:"children"}},"draggable",e.getDragOptions(),!1),e._l(e.children,(function(t){return n("child-item",{key:t.id,attrs:{child:t,entity_id:e.entity.id,tags:e.tags,reorderMode:e.reorderMode}})})),1)],1),e.canReorder&&!e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",icon:"swap_vert",label:e.$t("contents.reorder")},on:{click:e.startReorder}}):e._e(),e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{loading:e.reordering,disable:e.reordering,flat:"",icon:"done",label:e.$t("general.confirm"),color:"positive"},on:{click:e.reorder}}):e._e(),e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",label:e.$t("general.cancel"),color:"grey"},on:{click:e.cancelReorder}}):e._e()],1)])},g=[],f=(n("e956"),n("310e")),h=n.n(f),b=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-item",{staticClass:"child-item",class:{"cursor-drag":e.reorderMode}},[n("q-item-section",{attrs:{avatar:"",top:""}},[n("div",{staticClass:"flex items-center item-avatar"},[e.reorderMode?n("q-icon",{attrs:{name:"drag_indicator",size:"md",color:"grey"}}):e._e(),n("q-avatar",{attrs:{icon:e.$store.getters.iconOf(e.child.model),color:"grey","text-color":"white"}})],1)]),n("q-item-section",[n("q-item-label",[n("h3",[e.reorderMode?n("span",[e._v(e._s(e.child.title||e.$t(e.$store.getters.nameOf(e.child.model))))]):e._e(),e.reorderMode?e._e():n("router-link",{attrs:{to:{name:"content",params:{entity_id:e.child.id}}}},[e._v(e._s(e.child.title||e.$t(e.$store.getters.nameOf(e.child.model))))])],1)]),n("q-item-label",{attrs:{caption:"",lines:"1"}},[e._v(e._s(e.$t(e.$store.getters.nameOf(e.child.model))))])],1),e.tags&&e.tags.length>0?n("q-item-section",{attrs:{side:""}},[n("div",{staticClass:"row items-center"},[n("q-select",{ref:"tagSelector",attrs:{options:e.tags,multiple:"","use-chips":"",dense:"","options-dense":"",borderless:"","hide-dropdown-icon":""},on:{input:e.onInput},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"local_offer",size:"xs",color:"info"}})]},proxy:!0}],null,!1,2413332987),model:{value:e.editingTags,callback:function(t){e.editingTags=t},expression:"editingTags"}}),e.editing?n("q-btn",{attrs:{dense:"",outline:"",rounded:"",icon:"check",size:"sm",color:"positive",loading:e.saving},on:{click:e.acceptTags}},[e._v(e._s(e.$t("general.confirm"))+"  ")]):e._e(),e.editing?n("q-btn",{attrs:{dense:"",flat:"",rounded:"",size:"sm",color:"grey"},on:{click:e.cancelTags}},[e._v(e._s(e.$t("general.cancel")))]):e._e()],1)]):e._e()],1)},v=[],_={name:"ChildItem",props:["child","tags","reorderMode","entity_id"],data:function(){return{saving:!1,editing:!1,editingTags:[],storedTags:[]}},mounted:function(){this.editingTags=c.a.clone(this.child.child_relation_tags),this.storedTags=c.a.clone(this.child.child_relation_tags)},methods:{onInput:function(){this.$refs.tagSelector.hidePopup(),this.editing=!0},acceptTags:function(){var e=this;return l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.tagSelector.hidePopup(),e.saving=!0,e.storedTags=c.a.clone(e.editingTags),t.next=5,e.$api.post("/entity/".concat(e.child.id,"/relation"),{called_entity_id:e.entity_id,kind:"ancestor",tags:e.storedTags,position:e.child.child_relation_position,depth:1});case 5:e.saving=!1,e.editing=!1;case 7:case"end":return t.stop()}}),t)})))()},cancelTags:function(){this.$refs.tagSelector.hidePopup(),this.editingTags=c.a.clone(this.storedTags),this.editing=!1,this.saving=!1}}},y=_,w=n("2877"),q=Object(w["a"])(y,b,v,!1,null,null,null),k=q.exports,$={components:{ChildItem:k,draggable:h.a},name:"Children",props:{entity:{},readonly:{type:Boolean,default:!0},ofModel:{type:Array,default:function(){return[]}},models:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}},order_by:{type:String,default:"relation_children.position"}},data:function(){return{loading:!0,children:[],storedChildren:[],reorderMode:!1,reordering:!1}},mounted:function(){this.getChildren()},methods:{getChildren:function(){var e=this;return l()(r.a.mark((function t(){var n;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$api.get("/entities?child-of=".concat(e.entity.id,"&select=contents.title,published_at,unpublished_at,is_active,model,id,relation_children.relation_id&only-published=false&order-by=").concat(e.order_by));case 3:n=t.sent,e.loading=!1,n.success?e.children=n.data.data:e.$q.notify({position:"top",color:"negative",message:e.$t("general.serverError")});case 6:case"end":return t.stop()}}),t)})))()},add:function(e){this.$router.push({name:"content",params:{entity_id:"new",model:e,conector:"in",parent_entity_id:this.entity.id}})},getDragOptions:function(){return{animation:500,sort:!0}},startReorder:function(){this.storedChildren=c.a.cloneDeep(this.children),this.reorderMode=!0},cancelReorder:function(){this.children=c.a.cloneDeep(this.storedChildren),this.reorderMode=!1},reorder:function(){var e=this;return l()(r.a.mark((function t(){var n,i;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.reordering=!0,n=c.a.flatMap(e.children,(function(e){return e.relation_id})),t.next=4,e.$api.patch("/entities/relations/reorder",{relation_ids:n});case 4:i=t.sent,e.reordering=!1,i.success?e.reorderMode=!1:e.$q.notify({position:"top",color:"negative",message:e.$t("general.serverError")});case 7:case"end":return t.stop()}}),t)})))()}},computed:{canReorder:function(){return"relation_children.position"===this.order_by}}},C=$,x=(n("8928"),Object(w["a"])(C,p,g,!1,null,null,null)),M=x.exports,T=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.readonly,expression:"readonly"}]},[e.loading?n("div",{staticClass:"row q-col-gutter-md"},[n("q-skeleton",{staticClass:"col-3 offset-9 q-mt-md",attrs:{type:"QBtn"}}),e._l(3,(function(e){return n("div",{key:e,staticClass:"col-xs-12 col-sm-6 col-md-4"},[n("q-card",{staticClass:"full-width",attrs:{flat:"",bordered:""}},[n("q-skeleton",{attrs:{height:"200px",square:"",animation:"fade"}}),n("q-card-section",[n("q-skeleton",{staticClass:"text-subtitle2",attrs:{type:"text",animation:"fade"}}),n("q-skeleton",{staticClass:"text-subtitle2",attrs:{type:"text",width:"50%",animation:"fade"}})],1)],1)],1)}))],2):e._e(),e.loading?e._e():n("div",[n("div",{staticClass:"q-mb-md flex justify-end"},[e.allowed&&e.allowed.length>0?n("q-btn",{attrs:{outline:"",color:"positive",icon:"add_circle",label:e.$t("general.add")},on:{click:function(t){e.addMediaDialog=!0}}}):e._e()],1),n("draggable",e._b({staticClass:"row draggable-container q-col-gutter-md",attrs:{disabled:!e.reorderMode},model:{value:e.media,callback:function(t){e.media=t},expression:"media"}},"draggable",e.getDragOptions(),!1),e._l(e.media,(function(t){return n("div",{key:t.id,staticClass:"col-xs-12 col-sm-6 col-md-4"},[n("medium-item",{staticClass:"full-width full-height",attrs:{medium:t,entity_id:e.entity.id,tags:e.tags,reorderMode:e.reorderMode},on:{getMedia:e.getMedia}})],1)})),0),e.canReorder&&!e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",icon:"swap_vert",label:e.$t("contents.reorder")},on:{click:e.startReorder}}):e._e(),e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{loading:e.reordering,disable:e.reordering,flat:"",icon:"done",label:e.$t("general.confirm"),color:"positive"},on:{click:e.reorder}}):e._e(),e.reorderMode?n("q-btn",{staticClass:"q-mt-sm",attrs:{flat:"",label:e.$t("general.cancel"),color:"grey"},on:{click:e.cancelReorder}}):e._e()],1),n("q-dialog",{attrs:{persistent:""},on:{hide:e.onMediaDialogHide},model:{value:e.addMediaDialog,callback:function(t){e.addMediaDialog=t},expression:"addMediaDialog"}},[n("q-card",{staticStyle:{width:"90vw"}},[n("q-card-section",{staticClass:"q-pb-none"},[n("q-tabs",{staticClass:"text-grey",attrs:{"active-color":"primary","indicator-color":"info"},model:{value:e.addMediaTab,callback:function(t){e.addMediaTab=t},expression:"addMediaTab"}},[n("q-tab",{attrs:{name:"upload",label:e.$t("media.upload")}}),n("q-tab",{attrs:{name:"library",label:e.$t("media.library")}})],1)],1),n("q-separator"),"upload"===e.addMediaTab?n("q-card-section",{staticClass:"scroll",staticStyle:{height:"50vh"}},[n("q-file",{ref:"filePicker",staticClass:"full-width media-library-file-picker",class:{"with-files":this.uploadProgress.length>0},attrs:{value:e.uploadProgress,label:e.$t("media.select"),outlined:"",multiple:"",accept:e.acceptedFiles},on:{input:e.updateFiles},scopedSlots:e._u([{key:"file",fn:function(){},proxy:!0}],null,!1,3076132943)}),e.uploadProgress.length>0?n("q-list",{staticClass:"rounded-borders media-library-file-list q-mt-md"},e._l(e.uploadProgress,(function(t,i){return n("q-item",{key:i,staticClass:"q-pa-none q-mb-md"},[n("q-item-section",[n("nq-input",{staticClass:"full-width q-mb-xs",attrs:{diabled:t.uploading||t.created,readonly:t.uploading||t.created,size:"sm",dense:""},scopedSlots:e._u([{key:"append",fn:function(){return[n("small",[e._v(e._s(e._f("numeral")(t.size,"0a")))])]},proxy:!0}],null,!0),model:{value:t.name,callback:function(n){e.$set(t,"name",n)},expression:"fileToUpload.name"}}),n("q-item-label",[n("q-linear-progress",{staticClass:"full-width",attrs:{value:t.percent,color:t.color,indeterminate:t.creating}})],1)],1),n("q-item-section",{attrs:{side:""}},[e.uploading?e._e():n("q-btn",{staticClass:"q-ml-sm",attrs:{icon:"clear",size:"sm",round:"",flat:"",color:"grey"},on:{click:function(t){return e.removeFile(i)}}}),e.uploading?n("q-circular-progress",{attrs:{"track-color":"grey-3",value:t.uploaded?1:0,color:t.uploaded?"positive":"primary",indeterminate:t.uploading||t.creating,size:"sm"}}):e._e()],1)],1)})),1):e._e()],1):e._e(),"upload"===e.addMediaTab?n("q-separator"):e._e(),"upload"===e.addMediaTab?n("q-card-actions",{attrs:{align:"center"}},[n("q-btn",{directives:[{name:"close-popup",rawName:"v-close-popup"}],staticClass:"q-mr-md",attrs:{color:"grey",flat:"",label:e.$t("general.cancel")}}),n("q-btn",{attrs:{color:"primary",icon:"cloud_upload",label:"Upload",disable:!e.canUpload,loading:e.uploading},on:{click:e.upload}})],1):e._e(),"library"===e.addMediaTab?n("q-card-section",[n("div",{staticClass:"text-h6"},[e._v("TBD")])]):e._e()],1)],1)],1)},P=[],S=n("4db1"),E=n.n(S),D=(n("ac6a"),n("cadf"),n("06db"),n("c5f6"),n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("q-card",{staticClass:"medium-item",class:{"cursor-drag":e.reorderMode}},[e.medium.properties&&e.medium.properties.isWebImage?n("q-img",{staticClass:"checkered-bg",attrs:{src:""+e.$store.getters.media_url+e.medium.thumb,ratio:1,contain:""}}):e._e(),e.medium.properties&&e.medium.properties.isWebImage?e._e():n("q-responsive",{attrs:{ratio:1}},[n("div",{staticClass:"rounded-borders bg-grey-2 text-white flex flex-center"},[e.medium.properties&&e.medium.properties.isWebImage?e._e():n("q-icon",{attrs:{size:"80px",color:"grey-5",name:e.medium.properties?e.medium.properties.isImage?"image":e.medium.properties.isVideo?"movie":e.medium.properties.isAudio?"graphic_eq":e.medium.properties.isDocument?"description":"insert_drive_file":"blur_on"}})],1)]),n("q-btn-dropdown",{staticClass:"absolute-top-right",attrs:{round:"","dropdown-icon":"more_vert",flat:"",color:"grey-6"}},[n("q-list",[n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:{name:"content",params:{entity_id:e.medium.id}},target:"_blank"}},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"launch"}})],1),n("q-item-section",[n("q-item-label",[e._v(e._s(e.$t("media.edit")))])],1)],1),n("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.onUnlink}},[n("q-item-section",{attrs:{avatar:""}},[n("q-icon",{attrs:{name:"link_off"}})],1),n("q-item-section",[n("q-item-label",[e._v(e._s(e.$t("media.unlink")))])],1)],1)],1)],1),n("q-separator"),e.tags&&e.tags.length>0?n("q-card-actions",{staticClass:"row",attrs:{side:""}},[n("h3",{staticClass:"col-12",staticStyle:{"word-break":"break-all"}},[n("q-icon",{staticClass:"q-mr-xs",attrs:{name:e.medium.properties?e.medium.properties.isImage?"image":e.medium.properties.isVideo?"movie":e.medium.properties.isAudio?"graphic_eq":e.medium.properties.isDocument?"description":"insert_drive_file":"blur_on"}}),e._v("\n      "+e._s(e.medium.title||e.$t(e.$store.getters.nameOf(e.medium.model)))+"\n      "),e.medium.properties?n("span",{staticClass:"text-grey-8"},[e._v("("+e._s(e.medium.properties.format)+")")]):e._e()],1),n("div",{staticClass:"row items-center col-12"},[n("q-select",{ref:"tagSelector",attrs:{options:e.tags,multiple:"","use-chips":"",dense:"",borderless:"","hide-dropdown-icon":""},on:{input:e.onInput},scopedSlots:e._u([{key:"prepend",fn:function(){return[n("q-icon",{attrs:{name:"local_offer",size:"xs",color:"info"}})]},proxy:!0}],null,!1,2413332987),model:{value:e.editingTags,callback:function(t){e.editingTags=t},expression:"editingTags"}}),e.editing?n("q-btn",{attrs:{dense:"",outline:"",rounded:"",icon:"check",size:"sm",color:"positive",loading:e.saving},on:{click:e.acceptTags}},[e._v(e._s(e.$t("general.confirm"))+"  ")]):e._e(),e.editing?n("q-btn",{attrs:{dense:"",flat:"",rounded:"",size:"sm",color:"grey"},on:{click:e.cancelTags}},[e._v(e._s(e.$t("general.cancel")))]):e._e()],1)]):e._e()],1)}),O=[],L={name:"MediaItem",props:["medium","tags","reorderMode","entity_id"],data:function(){return{saving:!1,editing:!1,editingTags:[],storedTags:[]}},mounted:function(){this.editingTags=c.a.clone(this.medium.media_tags),this.storedTags=c.a.clone(this.medium.media_tags)},methods:{onInput:function(){this.$refs.tagSelector.hidePopup(),this.editing=!0},acceptTags:function(){var e=this;return l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.tagSelector.hidePopup(),e.saving=!0,e.storedTags=c.a.clone(e.editingTags),t.next=5,e.$api.post("/entity/".concat(e.entity_id,"/relation"),{called_entity_id:e.medium.id,kind:"medium",tags:e.storedTags,position:e.medium.media_position,depth:0});case 5:e.saving=!1,e.editing=!1;case 7:case"end":return t.stop()}}),t)})))()},cancelTags:function(){this.$refs.tagSelector.hidePopup(),this.editingTags=c.a.clone(this.storedTags),this.editing=!1,this.saving=!1},onUnlink:function(){var e=this;this.$q.dialog({title:this.$t("media.unlink"),ok:{label:this.$t("general.ok"),color:"primary"},cancel:{label:this.$t("general.cancel"),color:"grey",flat:!0},message:this.$t("media.unlinkConfirm")}).onOk(l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.delete("/entity/".concat(e.entity_id,"/relation/").concat(e.medium.id,"/medium"));case 2:e.$emit("getMedia");case 3:case"end":return t.stop()}}),t)}))))}}},R=L,z=(n("82dc"),Object(w["a"])(R,D,O,!1,null,null,null)),A=z.exports,j={components:{MediumItem:A,draggable:h.a},name:"Media",props:{entity:{},readonly:{type:Boolean,default:!0},allowed:{type:Array,default:function(){return[]}},tags:{type:Array,default:function(){return[]}}},data:function(){return{loading:!0,media:[],storedMedia:[],reorderMode:!1,reordering:!1,addMediaDialog:!1,addMediaTab:"upload",uploadProgress:[],uploading:!1}},mounted:function(){this.getMedia()},methods:{getMedia:function(){var e=this;return l()(r.a.mark((function t(){var n;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$api.get("/entities/medium?media-of=".concat(e.entity.id,"&select=contents.title,properties,is_active,model,id,relation_media.relation_id&only-published=false&order-by=relation_media.position&per-page=100"));case 3:n=t.sent,e.loading=!1,n.success?e.media=n.data.data:e.$q.notify({position:"top",color:"negative",message:e.$t("general.serverError")});case 6:case"end":return t.stop()}}),t)})))()},add:function(e){this.$router.push({name:"content",params:{entity_id:"new",model:e,conector:"in",parent_entity_id:this.entity.id}})},getDragOptions:function(){return{animation:500,sort:!0}},startReorder:function(){this.storedMedia=c.a.cloneDeep(this.media),this.reorderMode=!0},cancelReorder:function(){this.media=c.a.cloneDeep(this.storedMedia),this.reorderMode=!1},reorder:function(){var e=this;return l()(r.a.mark((function t(){var n,i;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.reordering=!0,n=c.a.flatMap(e.media,(function(e){return e.relation_id})),t.next=4,e.$api.patch("/entities/relations/reorder",{relation_ids:n});case 4:i=t.sent,e.reordering=!1,i.success?e.reorderMode=!1:e.$q.notify({position:"top",color:"negative",message:e.$t("general.serverError")});case 7:case"end":return t.stop()}}),t)})))()},updateFiles:function(e){var t=this,n=function(n){if(!c.a.find(t.uploadProgress,(function(t){return t.file.name===e[n].name&&t.file.lastModified===e[n].lastModified}))){var i=e[n].name,a=i.lastIndexOf(".");a>-1&&(i=i.substr("0",a)),i=i.replace("-"," "),i=i.replace("_"," "),t.uploadProgress.push({createError:!1,uploadError:!1,size:e[n].size,name:i,percent:0,indeterminate:!1,creating:!1,created:!1,uploading:!1,uploaded:!1,tags:[],file:e[n],color:"primary"})}};for(var i in e)n(i);this.$refs.filePicker.blur()},removeFile:function(e){this.uploadProgress.splice(e,1)},upload:function(){var e=this;return l()(r.a.mark((function t(){var n,i,a,o,s,l,d;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.uploading=!0,n=!0,t.t0=r.a.keys(e.uploadProgress);case 3:if((t.t1=t.t0()).done){t.next=44;break}if(i=t.t1.value,a={},e.uploadProgress[i].created){t.next=17;break}for(s in e.uploadProgress[i].creating=!0,o={},e.$store.state.ui.config.langs)o[e.$store.state.ui.config.langs[s]]=e.uploadProgress[i].name;return t.next=12,e.$api.post("/entity/".concat(e.entity.id,"/create_and_relate"),{model:"medium",kind:"medium",position:Number(e.media.length)+Number(i),tags:e.uploadProgress[i].tags,contents:{title:o}});case 12:a=t.sent,e.uploadProgress[i].creating=!1,e.uploadProgress[i].id=a.data.id,t.next=18;break;case 17:a.success=!0;case 18:if(!a.success){t.next=38;break}if(e.uploadProgress[i].createError=!1,e.uploadProgress[i].created=!0,l={},e.uploadProgress[i].uploaded){t.next=33;break}return e.uploadProgress[i].uploading=!0,e.uploadProgress[i].color="primary",e.uploadProgress[i].percent=0,d=new FormData,d.append("file",e.uploadProgress[i].file),t.next=30,e.$api.post("/medium/".concat(e.uploadProgress[i].id,"/upload"),d,{"Content-Type":"multipart/form-data"});case 30:l=t.sent,t.next=34;break;case 33:l.success=!0;case 34:e.uploadProgress[i].uploading=!1,l.success?(e.uploadProgress[i].uploadError=!1,e.uploadProgress[i].uploaded=!0,e.uploadProgress[i].percent=1,e.uploadProgress[i].color="positive"):(n=!1,e.uploadProgress[i].uploadError=!0,e.uploadProgress[i].percent=1,e.uploadProgress[i].color="negative"),t.next=42;break;case 38:n=!1,e.uploadProgress[i].createError=!0,e.uploadProgress[i].percent=0,e.uploadProgress[i].color="negative";case 42:t.next=3;break;case 44:n&&(e.getMedia(),e.onMediaDialogHide(),e.addMediaDialog=!1),e.uploading=!1;case 46:case"end":return t.stop()}}),t)})))()},onMediaDialogHide:function(){this.uploadProgress=[]}},computed:{canReorder:function(){return this.media.length>1},canUpload:function(){return this.uploadProgress.length>0},acceptedFiles:function(){var e=this;if(!this.allowed||"*"===this.allowed[0]||""===this.allowed[0]||""===this.allowed||"*"===this.allowed)return"";var t=[];return c.a.each(this.allowed,(function(n){t=[].concat(E()(t),E()(c.a.get(e.$store.state.ui.config,"formats.".concat(n),[n])))})),"."+t.join(", .")}}},I=j,F=(n("4c65"),Object(w["a"])(I,T,P,!1,null,null,null)),B=F.exports,N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("nq-field",{staticClass:"html-editor",attrs:{label:e.label,readonly:e.readonly,"stack-label":""}},[n("div",{staticClass:"full-width"},[n("editor-menu-bar",{staticStyle:{position:"sticky",top:"64px","z-index":"100"},attrs:{editor:e.editor},scopedSlots:e._u([{key:"default",fn:function(t){var i=t.commands,a=t.isActive,o=t.getMarkAttrs;return[n("div",{directives:[{name:"show",rawName:"v-show",value:!e.readonly,expression:"!readonly"}],staticClass:"editor-menu-bar"},e._l(e.toolbar,(function(t,r){return n("q-btn-group",{key:r,staticClass:"q-mr-sm q-mb-sm bg-white"},e._l(t,(function(t,r){return n("q-btn",{directives:[{name:"show",rawName:"v-show",value:!t.showCommand||a[t.showCommand](),expression:"action.showCommand ? isActive[action.showCommand]() : true"}],key:r,attrs:{size:"sm",flat:"",round:"",color:t.color?t.color:a[t.activeCommand||t.command](t.dontSendParamsToActiveCommand?{}:t.params)?"info":"dark",icon:t.icon,label:t.label},on:{click:function(n){t.method?e.methodBridge(t.method,i[t.command],o(t.command)):t.command&&i[t.command](t.params)}}})})),1)})),1)]}}])}),n("div",{staticClass:"editor-content-container"},[n("editor-content",{staticClass:"editor-content",attrs:{editor:e.editor}})],1)],1)])},V=[],U=n("cd42"),H=n("f23d"),Q={name:"HtmlEdior",components:{EditorContent:U["b"],EditorMenuBar:U["c"]},mounted:function(){var e=this;this.editor=new U["a"]({content:this.value,editable:!this.readonly,extensions:[new H["g"]({levels:[1,2,3]}),new H["b"],new H["i"],new H["m"],new H["r"],new H["e"],new H["d"],new H["c"],new H["l"],new H["k"],new H["a"],new H["n"],new H["p"],new H["o"],new H["q"],new H["h"],new H["f"],new H["j"]({openOnClick:!1})],onUpdate:function(t){var n=t.getHTML;e.contentUpdated(n())}})},props:{value:String,label:String,readonly:{type:Boolean,default:!0},toolbar:{type:Array,default:function(){return[[{command:"paragraph",label:"P",params:{}},{command:"heading",label:"H1",params:{level:1}},{command:"heading",label:"H2",params:{level:2}},{command:"heading",label:"H3",params:{level:3}},{command:"code_block",icon:"code"}],[{command:"bold",icon:"format_bold"},{command:"italic",icon:"format_italic"},{command:"strike",icon:"format_strikethrough"},{command:"underline",icon:"format_underline"},{command:"code",icon:"functions"}],[{method:"addLink",command:"link",activeCommand:"link",icon:"link"}],[{command:"bullet_list",icon:"format_list_bulleted"},{command:"ordered_list",icon:"format_list_numbered"},{command:"blockquote",icon:"format_quote"}],[{command:"createTable",activeCommand:"table",icon:"border_all",params:{rowsCount:3,colsCount:3,withHeaderRow:!0},dontSendParamsToActiveCommand:!0},{command:"deleteTable",activeCommand:"table",showCommand:"table",icon:"border_all",color:"negative"},{command:"addColumnBefore",activeCommand:"table",showCommand:"table",icon:"border_left",color:"positive"},{command:"addColumnAfter",activeCommand:"table",showCommand:"table",icon:"border_right",color:"positive"},{command:"deleteColumn",activeCommand:"table",showCommand:"table",icon:"border_vertical",color:"negative"},{command:"addRowBefore",activeCommand:"table",showCommand:"table",icon:"border_top",color:"positive"},{command:"addRowAfter",activeCommand:"table",showCommand:"table",icon:"border_bottom",color:"positive"},{command:"deleteRow",activeCommand:"table",showCommand:"table",icon:"border_horizontal",color:"negative"},{command:"toggleCellMerge",activeCommand:"table",showCommand:"table",icon:"border_outer",color:"dark"}]]}}},data:function(){return{editor:null}},methods:{methodBridge:function(e,t,n){this[e](t,n)},addLink:function(e,t){this.$q.dialog({title:"Link address",prompt:{model:t.href||"https://",type:"text"},cancel:!0,persistent:!0}).onOk((function(t){e({href:t})})).onCancel((function(){})).onDismiss((function(){}))},contentUpdated:function(e){this.$emit("input",e)}},watch:{readonly:function(){this.editor.setOptions({editable:!this.readonly})}},beforeDestroy:function(){this.editor.destroy()}},Y=Q,W=(n("d41e"),Object(w["a"])(Y,N,V,!1,null,null,null)),J=W.exports,Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"flex justify-between"},[n("nq-input",{staticStyle:{flex:"1"},attrs:{readonly:e.readonly||e.auto,label:e.label},model:{value:e.computedValue,callback:function(t){e.computedValue=t},expression:"computedValue"}}),e._v("\n  "+e._s(e.entity.title)+"\n  "),e.readonly?e._e():n("q-checkbox",{attrs:{label:"Auto"},on:{input:e.changeAuto},model:{value:e.auto,callback:function(t){e.auto=t},expression:"auto"}})],1)},G=[],K=(n("28a5"),n("3666")),X=n.n(K),ee={props:{value:{type:String,default:""},readonly:{type:Boolean,default:!0},label:{type:String,default:"Slug"},entity:{type:Object,default:function(){return{}}},lang:{type:String,default:null},fromField:{type:String,default:"contents.title"}},data:function(){return{auto:!1,referenceField:{type:null,object:null,prop:null},referencedValue:""}},mounted:function(){"new"===this.entity.id&&(this.auto=!0);var e=this.fromField.split(".");if(1===e.length)this.referenceField={type:"entity",object:this.entity,prop:e[0]};else if("contents"===e[0])for(var t in this.entity.contents)this.entity.contents[t].field===e[1]&&this.entity.contents[t].lang===this.lang&&(this.referenceField={type:"content",object:this.entity.contents[t],prop:"text"});else"properties"===e[0]&&(this.referenceField=this.entity.properties,this.referenceField={type:"properties",object:this.entity.properties,prop:e[1]})},computed:{valueReference:function(){return null===this.referenceField.type?null:this.referenceField.object[this.referenceField.prop]},computedValue:{get:function(){return this.value},set:function(e){this.$emit("input",e)}}},methods:{calculateSlug:function(){this.$emit("input",X()(this.referencedValue,{lower:!0,strict:!0}))},changeAuto:function(){this.auto&&this.calculateSlug()}},watch:{valueReference:function(e){this.referencedValue=e,this.auto&&this.calculateSlug()}}},te=ee,ne=Object(w["a"])(te,Z,G,!1,null,null,null),ie=ne.exports,ae={name:"Content",components:{Children:M,Media:B,HtmlEditor:J,Slug:ie},data:function(){return{editing:!1,loading:!0,saving:!1,fieldsets:[],ancestors:[],entity:{id:"",model:"",view:"",contents:[],entity_relations:[],parent_entity_id:"",is_active:!0,properties:{},published_at:null,unpublished_at:null,version:0,version_full:0,version_relations:0,version_tree:0,created_at:null,updated_at:null,updated_by:null}}},created:function(){var e=this;return l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.refreshEntity(e.$route.params.entity_id);case 2:case"end":return t.stop()}}),t)})))()},beforeRouteUpdate:function(e,t,n){var i=this;return l()(r.a.mark((function t(){return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.refreshEntity(e.params.entity_id,e.params.model,e.params.parent_entity_id);case 2:n();case 3:case"end":return t.stop()}}),t)})))()},methods:{refreshEntity:function(e,t,n){var i=this;return l()(r.a.mark((function a(){var o,s;return r.a.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(i.loading=!0,i.editing=!1,i.saving=!1,i.fieldsets=[],i.$store.commit("setEditButton",!0),i.$store.commit("setSaveButton",!1),i.entity.id=e||"home","new"===e){a.next=23;break}return a.next=10,i.$api.get("/entity/".concat(i.entity.id,"?with=contents,entities_related"));case 10:if(o=a.sent,i.loading=!1,!o.success){a.next=20;break}return i.entity=o.data,a.next=16,i.$api.get("/entities/?ancestor-of=".concat(i.entity.id,"&descendant-of=website&select=id,contents.title&order-by=ancestor_relation_depth:desc"));case 16:s=a.sent,s.success?i.ancestors=s.data.data:i.ancestors=[],a.next=21;break;case 20:i.entity={contents:[],entity_relations:[]};case 21:a.next=32;break;case 23:i.entity=c.a.cloneDeep(i.$store.state.content.blankEntity),i.entity.model=t||i.$route.params.model,i.entity.view=t||i.$route.params.model,i.entity.id=e||i.$route.params.entity_id,i.entity.parent_entity_id=n||i.$route.params.parent_entity_id,i.entity.published_at=m()().format(),i.entity.unpublished_at=null,i.editing=!0,i.loading=!1;case 32:i.fieldsets=c.a.get(i.$store.state,"ui.config.models.".concat(i.entity.model,".form"),[]);case 33:case"end":return a.stop()}}),a)})))()},getValue:function(e){if(!e.isMultiLang)return this.entity[e.value];var t=this.findContentRow(e.props);if(t)return t.text;this.entity.contents.push({lang:e.props.lang,field:e.props.field,text:""})},setValue:function(e,t){if(e.isMultiLang){var n=this.findContentRow(e.props);n&&(n.text=t)}else this.entity[e.value]=t},findContentRow:function(e){if(this.entity)return c.a.find(this.entity.contents,(function(t){return t.lang===e.lang&&t.field===e.field}))},cancel:function(){this.isNew?this.$router.replace({name:"content",params:{entity_id:this.$route.params.parent_entity_id}}):this.refreshEntity(this.entity.id)},save:function(){var e=this;return l()(r.a.mark((function t(){var n;return r.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.saving=!0,!e.isNew){t.next=8;break}return delete e.entity.id,t.next=5,e.$api.post("/entity",e.entity);case 5:n=t.sent,t.next=11;break;case 8:return t.next=10,e.$api.patch("/entity/".concat(e.entity.id),e.entity);case 10:n=t.sent;case 11:e.saving=!1,n.success?(e.$q.notify({position:"top",color:"positive",message:e.$t("content.saveOk")}),e.editing=!1):e.$q.notify({position:"top",color:"negative",message:e.$t("general.saveError"),caption:"".concat(n.data.message," (").concat(n.status,")")});case 13:case"end":return t.stop()}}),t)})))()}},computed:{getEntityTitle:function(){if(!this.entity)return"";var e=this.findContentRow({lang:this.$store.state.ui.config.langs[0],field:"title"});return e&&""!==e.text?e.text:this.$store.getters.nameOf(this.entity.model)},isNew:function(){return"new"===this.$route.params.entity_id},views:function(){return c.a.get(this.$store.state,"ui.config.models.".concat(this.entity.model,".views"),[this.entity.model])},contentLang:{set:function(e){this.$store.commit("setLang",e)},get:function(){return this.$store.state.ui.lang}}}},oe=ae,re=(n("0733"),Object(w["a"])(oe,i,a,!1,null,null,null));t["default"]=re.exports},d01d:function(e,t,n){},d41e:function(e,t,n){"use strict";var i=n("ec3b"),a=n.n(i);a.a},ec3b:function(e,t,n){}}]);