(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[5],{"057b":function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-form",[i("nq-page",{attrs:{title:"Media","max-width":"lg"}},[i("h1",[e._v(" ")]),i("q-card",[i("q-card-section",[i("media-library")],1)],1)],1)],1)},s=[],n=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.loading?i("div",{staticClass:"row q-col-gutter-md"},e._l(3,(function(e){return i("div",{key:e,staticClass:"col-xs-12 col-sm-6 col-md-4"},[i("q-card",{staticClass:"full-width",attrs:{flat:"",bordered:""}},[i("q-skeleton",{attrs:{height:"200px",square:"",animation:"fade"}}),i("q-card-section",[i("q-skeleton",{staticClass:"text-subtitle2",attrs:{type:"text",animation:"fade"}}),i("q-skeleton",{staticClass:"text-subtitle2",attrs:{type:"text",width:"50%",animation:"fade"}})],1)],1)],1)})),0):e._e(),e.loading?e._e():i("div",[i("div",{staticClass:"q-mb-md flex justify-end"},[i("q-btn-dropdown",{attrs:{outline:"",color:"positive",icon:"filter_alt",label:"Filter"}},[i("q-list",e._l(e.filters,(function(t){return i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],key:t.label,attrs:{clickable:""},on:{click:function(i){return e.addFilter(t)}}},[i("q-item-section",[i("q-item-label",[e._v(e._s(t.label))])],1)],1)})),1)],1)],1),i("draggable",{staticClass:"row draggable-container q-col-gutter-md"},e._l(e.media,(function(t){return i("div",{key:t.id,staticClass:"col-xs-12 col-sm-6 col-md-4"},[i("medium-item",{staticClass:"full-width full-height",attrs:{medium:t,entity_id:[],tags:[],allowed:[],reorderMode:[]},on:{getMedia:e.getMedia}})],1)})),0)],1)])},r=[],o=i("967e"),l=i.n(o),c=(i("96cf"),i("fa84")),d=i.n(c),m=i("310e"),u=i.n(m),p=i("55f0"),g={components:{MediumItem:p["a"],draggable:u.a},name:"MediaLibrary",data:function(){return{loading:!0,media:[],filters:{all:{label:"All",request:"/entities/medium?select=contents.title,properties,is_active,model,id&only-published=false&per-page=100"},images:{label:"Images",request:"/entities/medium?where=properties.isImage:true"},audios:{label:"Audios",request:"/entities/medium?where=properties.isAudio:true"},four:{label:"Videos",request:"/entities/medium?where=properties.isVideo:true"}}}},mounted:function(){this.getMedia()},methods:{getMedia:function(){var e=this;return d()(l.a.mark((function t(){var i;return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.loading=!0,t.next=3,e.$api.get("/entities/medium?select=contents.title,properties,is_active,model,id&only-published=false&per-page=100");case 3:i=t.sent,console.log(i),e.loading=!1,i.success?e.media=i.data.data:e.$q.notify({position:"top",color:"negative",message:e.$t("general.serverError")});case 7:case"end":return t.stop()}}),t)})))()},addFilter:function(e){var t=this;return d()(l.a.mark((function i(){var a;return l.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return t.loading=!0,i.next=3,t.$api.get(e.request);case 3:a=i.sent,console.log(a),t.loading=!1,a.success?t.media=a.data.data:t.$q.notify({position:"top",color:"negative",message:t.$t("general.serverError")});case 7:case"end":return i.stop()}}),i)})))()}},computed:{}},f=g,h=i("2877"),v=Object(h["a"])(f,n,r,!1,null,null,null),_=v.exports,b={name:"Media",components:{MediaLibrary:_},data:function(){return{}},methods:{}},q=b,w=Object(h["a"])(q,a,s,!1,null,null,null);t["default"]=w.exports},"55f0":function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("q-card",{staticClass:"medium-item",class:{"cursor-drag":e.reorderMode}},[e.medium.properties&&e.medium.properties.isWebImage&&"svg"!==e.medium.properties.format&&!e.uploading?i("q-img",{staticClass:"checkered-bg",attrs:{src:e.medium.thumb+"?"+Math.random(),ratio:1,contain:""}}):e._e(),e.medium.properties&&e.medium.properties.isWebImage&&"svg"===e.medium.properties.format&&!e.uploading?i("q-img",{staticClass:"checkered-bg",attrs:{src:e.medium.original+"?"+Math.random(),ratio:1,contain:""}}):e._e(),e.medium.properties&&e.medium.properties.isWebImage&&!e.uploading?e._e():i("q-responsive",{attrs:{ratio:1}},[i("div",{staticClass:"rounded-borders bg-grey-2 text-white flex flex-center"},[e.medium.properties&&e.medium.properties.isWebImage?e._e():i("q-icon",{attrs:{size:"80px",color:"grey-5",name:e.medium.properties?e.medium.properties.isImage?"image":e.medium.properties.isVideo?"movie":e.medium.properties.isAudio?"graphic_eq":e.medium.properties.isDocument?"description":"insert_drive_file":"blur_on"}})],1)]),i("q-icon",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],staticClass:"absolute-top-left",staticStyle:{left:"16px",top:"16px",opacity:"0.5"},attrs:{name:"cloud_upload",size:"lg"}}),i("q-file",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"filePicker",staticClass:"absolute-top-left",staticStyle:{width:"4em",height:"4em",left:"8px",top:"8px"},attrs:{label:"",outlined:"",rounded:"",accept:e.acceptedFile,loading:e.uploading},on:{input:e.updateFile,rejected:e.rejectedFile},scopedSlots:e._u([{key:"file",fn:function(){},proxy:!0}])}),i("q-btn-dropdown",{staticClass:"absolute-top-right",attrs:{round:"","dropdown-icon":"more_vert",flat:"",color:"grey-6"}},[i("q-list",[i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:"",to:{name:"content",params:{entity_id:e.medium.id}},target:"_blank"}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"launch"}})],1),i("q-item-section",[i("q-item-label",[e._v(e._s(e.$t("media.edit")))])],1)],1),i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:e.onUnlink}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"link_off"}})],1),i("q-item-section",[i("q-item-label",[e._v(e._s(e.$t("media.unlink")))])],1)],1),i("q-item",{directives:[{name:"close-popup",rawName:"v-close-popup"}],attrs:{clickable:""},on:{click:function(t){return e.$refs.filePicker.pickFiles()}}},[i("q-item-section",{attrs:{avatar:""}},[i("q-icon",{attrs:{name:"cloud_upload"}})],1),i("q-item-section",[i("q-item-label",[e._v(e._s(e.$t("media.replace")))])],1)],1)],1)],1),i("q-separator"),i("q-card-actions",{staticClass:"row",attrs:{side:""}},[i("h3",{staticClass:"col-12",staticStyle:{"word-break":"break-all"}},[i("q-icon",{staticClass:"q-mr-xs",attrs:{name:e.medium.properties?e.medium.properties.isImage?"image":e.medium.properties.isVideo?"movie":e.medium.properties.isAudio?"graphic_eq":e.medium.properties.isDocument?"description":"insert_drive_file":"blur_on"}}),e._v("\n      "+e._s(e.medium.content.title||e.$t(e.$store.getters.nameOf(e.medium.model)))+"\n      "),e.medium.properties?i("span",{staticClass:"text-grey-8"},[e._v("("+e._s(e.medium.properties.format)+")")]):e._e()],1),e.tags&&e.tags.length>0?i("div",{staticClass:"row items-center col-12"},[i("q-select",{ref:"tagSelector",staticClass:"tag-select",attrs:{options:e.tags,multiple:"","use-chips":"",dense:"",borderless:""},on:{input:e.onInput},scopedSlots:e._u([{key:"append",fn:function(){return[i("q-icon",{attrs:{name:"local_offer",size:"xs",color:"info"}}),i("small",[e._v(e._s(e.$t("contents.addTag")))])]},proxy:!0}],null,!1,3002110394),model:{value:e.editingTags,callback:function(t){e.editingTags=t},expression:"editingTags"}}),e.editing?i("q-btn",{attrs:{dense:"",outline:"",rounded:"",icon:"check",size:"sm",color:"positive",loading:e.saving},on:{click:e.acceptTags}},[e._v(e._s(e.$t("general.confirm"))+"  ")]):e._e(),e.editing?i("q-btn",{attrs:{dense:"",flat:"",rounded:"",size:"sm",color:"grey"},on:{click:e.cancelTags}},[e._v(e._s(e.$t("general.cancel")))]):e._e()],1):e._e()])],1)},s=[],n=i("4db1"),r=i.n(n),o=(i("7f7f"),i("967e")),l=i.n(o),c=(i("96cf"),i("fa84")),d=i.n(c),m=i("2ef0"),u=i.n(m),p={name:"MediaItem",props:["medium","tags","reorderMode","entity_id","allowed"],data:function(){return{uploading:!1,saving:!1,editing:!1,editingTags:[],storedTags:[]}},mounted:function(){this.editingTags=u.a.clone(this.medium.medium.tags),this.storedTags=u.a.clone(this.medium.medium.tags)},methods:{onInput:function(){this.$refs.tagSelector.hidePopup(),this.editing=!0},acceptTags:function(){var e=this;return d()(l.a.mark((function t(){return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.$refs.tagSelector.hidePopup(),e.saving=!0,e.storedTags=u.a.clone(e.editingTags),t.next=5,e.$api.post("/entities/".concat(e.entity_id,"/relations/").concat(e.medium.id,"/medium"),{tags:e.storedTags,position:e.medium.media_position,depth:0});case 5:e.saving=!1,e.editing=!1;case 7:case"end":return t.stop()}}),t)})))()},cancelTags:function(){this.$refs.tagSelector.hidePopup(),this.editingTags=u.a.clone(this.storedTags),this.editing=!1,this.saving=!1},onUnlink:function(){var e=this;this.$q.dialog({title:this.$t("media.unlink"),ok:{label:this.$t("general.ok"),color:"primary"},cancel:{label:this.$t("general.cancel"),color:"grey",flat:!0},message:this.$t("media.unlinkConfirm")}).onOk(d()(l.a.mark((function t(){return l.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$api.delete("/entities/".concat(e.entity_id,"/relations/").concat(e.medium.id,"/medium"));case 2:e.$emit("getMedia");case 3:case"end":return t.stop()}}),t)}))))},updateFile:function(e){var t=this;return d()(l.a.mark((function i(){var a;return l.a.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return a=new FormData,a.append("file",e),t.uploading=!0,i.next=5,t.$api.post("/media/".concat(t.medium.id,"/upload"),a,{"Content-Type":"multipart/form-data"});case 5:t.uploading=!1;case 6:case"end":return i.stop()}}),i)})))()},rejectedFile:function(e){var t="";for(var i in e)t+=" - "+e[i].file.name;this.$q.notify({position:"top",color:"negative",message:this.$t("media.invalidFormat"),caption:t})}},computed:{acceptedFile:function(){var e=this;if(!this.allowed||"*"===this.allowed[0]||""===this.allowed[0]||""===this.allowed||"*"===this.allowed)return"";var t=[];return u.a.each(this.allowed,(function(i){t=[].concat(r()(t),r()(u.a.get(e.$store.state.ui.config,"formats.".concat(i),[i])))})),"."+t.join(", .")}}},g=p,f=(i("82dc"),i("2877")),h=Object(f["a"])(g,a,s,!1,null,null,null);t["a"]=h.exports},"82dc":function(e,t,i){"use strict";var a=i("b69d"),s=i.n(a);s.a},b69d:function(e,t,i){}}]);